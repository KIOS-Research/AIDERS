{% extends "base.html" %}

{% load static %}
{% load guardian_tags %}

{% block title %}
Aiders - Drones
{% endblock %}


{% block head_block %}
    <script src="{% static 'aiders/javascripts/drone_change_operation/drone_change_operation.js' %}" type="text/javascript"></script>
    <script src="{% static 'aiders/javascripts/popups/popups.js' %}" type="text/javascript"></script>
    <script src="{% static 'aiders/javascripts/dutils/dutils.js' %}" type="text/javascript"></script>
    <script src="{% static 'aiders/javascripts/dutils/dutils_conf_urls.js' %}" type="text/javascript"></script>

    

    <link href="{% static 'libs/jquery-ui/http_ajax.googleapis.com_ajax_libs_jqueryui_1.12.1_themes_smoothness_jquery-ui.css' %}" rel="stylesheet">

    <script src="{% static 'libs/jquery-ui/http_ajax.googleapis.com_ajax_libs_jqueryui_1.12.1_jquery-ui.js' %}"></script>

    <link href="{% static 'libs/jquery.mCustomScrollbar/__malihu.github.io_custom-scrollbar_jquery.mCustomScrollbar.min.css' %}" rel="stylesheet">

    <link href="{% static 'libs/jquery-ui/__code.jquery.com_ui_1.12.1_themes_base_jquery-ui.css' %}" rel="stylesheet">
    <script src="{% static 'libs/hls/http_cdn.jsdelivr.net_npm_hls.js@1.2.0.js' %}"></script>

    

    <link href="{% static 'libs/jquery.dataTables/http_cdn.datatables.net_1.10.2_css_jquery.dataTables.css' %}" rel="stylesheet">
    <script src="{% static 'libs/jquery.dataTables/http_cdn.datatables.net_1.10.2_js_jquery.dataTables.js' %}"></script>

{% endblock %}


{% block body_block %}

<div class="justify-content-center ms-5 me-5 footer-margin header-margin">
    <div class="row pt-5">
        <h3 class="col float-start">Drones</h3>
        <div class="col">
            <a class="btn btn-primary float-end mx-1 {% if not perms.aiders.edit_permissions %}disabled{% endif %}" href="{% url 'manage_permissions' %}">
                <i class="fa fa-key "></i>
                Edit Permissions
            </a>
            <a class="btn btn-success float-end mx-1 {% if not perms.aiders.edit_permissions %}disabled{% endif %}" href="{% url 'mavlinkAdd' %}">
                <i class="far fa-plus "></i>
                Add MAVLink UAV
            </a>                
        </div>
    </div>
    <div class="row mb-5">
        <div class="col-sm" style="color: black">
            <div><br/></div>

                <table id="Table" class="table table-striped">
                <thead>
                <tr>
                    <th> ID</th>
                    <th> Drone Name</th>
                    <th> Model</th>
                    <th> Comm. Type</th>
                    <th> Camera Model</th>
                    <th> Operation</th>
                    <th> Connected</th>
                    <th style="width: 14%"> Actions</th>

                </tr>
                </thead>
                <tbody>
                    {% if drones %}
                        {% for drone in drones %}
                            <tr>
                                
                                <td class='align-middle'> {{drone.id}}</td>
                                <td class='align-middle'> {{drone.drone_name}}</td>
                                <td class='align-middle'> {{drone.model}}</td>
                                <td class='align-middle'> {{drone.type}}</td>
                                <td class='align-middle'> {{drone.camera_model}}</td>
                                <td class='align-middle'> {{drone.operation}}</td>
                                <td class='align-middle'> {% if drone.is_connected_with_platform == True %}<i class="fa-solid fa-check"></i>{% else %}<i class="fa-solid fa-xmark"></i>{% endif %}</td>
                                <td>
                                    <div>
                                        <form class='m-1' style='float: left;'>
                                            <button type="Button" title="Assign this drone to an operation"  onclick="Edit_drone_operation('{{drone.drone_name}}')" class="btn btn-warning"><i style="color:white;" class="fa-solid fa-gear"></i></button>
                                        </form>
                                    </div>
                                    <div>
                                        <form class='m-1' style='float: left;' method="post" action="{% url 'join_operation' operation_name=drone.operation %}">
                                            {% csrf_token %}
                                            {% get_obj_perms request.user for drone.operation as "permission_list" %}
                                            <button type="submit" title="Open map for this drone's operation" class="btn btn-success"
                                                    {% if not "join_operation" in permission_list or not drone.operation.active or drone.operation == None %}
                                                        disabled
                                                    {% endif %}>
                                                <i class="fa-solid fa-map-location-dot"></i></button>
                                        </form>
                                    </div>

                                    {% if drone.type == "MAVLINK" %}

                                        {% if drone.is_connected_with_platform == False %}
                                            <a title="Connect to MAVLink UAV" 
                                                style='margin-left: 4px; margin-top: 4px' 
                                                class="btn btn-success 
                                                {% if not perms.aiders.edit_permissions %} disabled {% endif %}
                                                {% if not drone.operation.active or drone.operation == None %} disabled {% endif %}"
                                                href="{% url 'mavlinkManage' pk=drone.id %}">
                                                    <i class="fa fa-link "></i>
                                            </a>
                                        {% else %}
                                            <a title="Disconnect from MAVLink UAV" 
                                                style='margin-left: 4px; margin-top: 4px' 
                                                class="btn btn-danger 
                                                {% if not perms.aiders.edit_permissions %} disabled {% endif %}"
                                                href="{% url 'mavlinkManage' pk=drone.id %}">
                                                    <i class="fa fa-link-slash "></i>
                                            </a>
                                        {% endif %}

                                        <a title="Edit MAVLink UAV"
                                            style='margin-left: 4px; margin-top: 4px'
                                            class="btn btn-primary 
                                            {% if not perms.aiders.edit_permissions %}disabled{% endif %}
                                            {% if drone.is_connected_with_platform == True %} disabled {% endif %}"
                                            href="{% url 'mavlinkEdit' pk=drone.id %}">
                                                <i class="far fa-edit "></i>
                                        </a>
                                    {% endif %}

    {#                                <div>#}
    {#                                    <form class='m-1' style='float: left;' method="get" action="#">#}
    {#                                        <button type="submit" class="btn btn-danger" ><i class="fa-solid fa-trash"></i></i></button>#}
    {#                                    </form>#}
    {#                                </div>#}
                                </td>
                            </tr>
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>
</div>
<div id="csrf">
    {% csrf_token %}
</div>



{% endblock %}

{% block script_block %}

    $(document).ready(function(){
    $('#Table').dataTable();
    });

{% endblock %}
